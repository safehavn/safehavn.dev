<html>
  <head>
    <title>開発日記 2023-11-08 -- SAFE HAVN STUDIO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/style.css" rel="stylesheet" type="text/css" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <meta property="og:title" content="開発日記 2023-11-08" />
    <meta
      property="og:description"
      content="今週の開発日記です。さっき目薬を差すのに失敗して、まぶたがびしゃびしゃになりました。ぐわー"
    />
    <meta property="og:image" content="https://safehavn.dev/ogp.png" />
    <meta name="twitter:card" content="summary" />
  </head>
  <body>
    <div class="container">
      <header>
        <ul class="nav-list-left">
          <li class="nav-list-item">
            <a href="/" class="brand-link">SAFE HAVN STUDIO</a>
          </li>
        </ul>
        <!-- <ul class="nav-list-right">
          <li class="nav-list-item">
            <a href="../index.html">EN</a>
          </li>
          <li class="nav-list-item selected">JA</li>
        </ul> -->
      </header>
      <div class="main">
        <article>
          <h1 id="2023-11-08">開発日記 2023-11-08</h1>
          <p>今週の開発日記です。さっき目薬を差すのに失敗して、まぶたがびしゃびしゃになりました。ぐわー</p>
          <p>個人的な近況報告：<a href="https://www.au5music.com/">Au5</a>の来日公演を見に行きました。ずっと昔からメロディックなダブステップを作っているアーティストで、有名な曲がいくつもあり、2010年代にYouTubeを見ていた人ならどこかでこの人の曲を聞いたことがあると思います。</p>
          <figure>
            <img src="./au5.webp" />
            <figcaption>うっすら奥に見えるのがAu5</figcaption>
          </figure>
          <p>自分の好みはもう少しハード系というかミニマルなビートなのですが、それでも大音量でエピックなドロップを聴くと感動します。Au5自身の過去曲や最近の曲だけでなく、Akira Complexの作品も流してくれていたみたいです。予習不足で、その場では周りが盛り上がってる理由が分からなかったのですが...あとで知って納得しました。エモいしすごい。</p>
          <h4 id="-2-">シナリオ執筆(2)</h4>
          <p><a href="https://safehavn.dev/blog/2023-11-01/">前回の記事</a>でお伝えした通り、ゲームのシナリオ、特に本編全体のプロットを集中的に書いています。</p>
          <p>細かい部分は埋まっていないものの、シナリオ全体の大きな出来事と、エンディングの内容はなんとか書き終わりました。あとはスプレッドシートとにらめっこして、ありそうな矛盾をつぶしたり、細かい間の出来事を埋めたりしていくはずです。</p>
          <p>うーん...とはいえ、実際にシナリオを書き始めてみると、書いている途中に新しいアイデアが浮かんだり、キャラクターが思っていたのと違う性格になってしまったりして、全然違う話になっちゃったりします。いまはそのたびにプロットのほうを更新しています。</p>
          <p>プロットについて書きたいことは沢山あるんですけど、発表前だと何を書いても変な先入観を与えてしまいそうです。「伏線を大事にしたい」って書いたら伏線を探されそう。「会話を大事にしたい」って書いたら、逆に伏線は放置されたり...？</p>
          <p>うーん、難しい、もっと書きやすいことを書こう！</p>
          <h4 id="-">新キャラ描き始め</h4>
          <p>書きやすいこと。上に挙げた本編のプロットに沿って、新しいキャラクターの立ち絵を描き始めています。１つは勢い余ってTwitterにも掲載しました。</p>
          <figure>
            <blockquote class="twitter-tweet"><p lang="en" dir="ltr">Sorry for being offline recently, but we&#39;re dedicating all our effort to the game✨ <a href="https://t.co/SzvHxqiNFP">pic.twitter.com/SzvHxqiNFP</a></p>&mdash; SAEKO: Giantess Dating Sim (@saekogame) <a href="https://twitter.com/saekogame/status/1721835842573111782?ref_src=twsrc%5Etfw">November 7, 2023</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </figure>
          <p>本編のキャラクターについては、kohにキャラクターの特徴を伝え、それを元にラフなキャラデザを作ってもらっています。</p>
          <figure>
            <img src="./proposal.webp">
          </figure>
          <p>美しい絵。ですが、これも最終的に立ち絵を書いている私の手にかかるとこうなります。</p>
          <figure>
            <img src="./result.webp">
          </figure></p>
          <p>...君、ずいぶん雰囲気違うね？</p>
          <p>これは私がデフォルメ風の絵しか描けないのと、kohに設定資料を与えてから、例によってプロットが変わりまくったのが原因です。性格だけでなく、この子に至ってはキャラの名前すら変更されています。</p>
          <p>そして、アニメーションについて。</p>
          <p>仲間の小人と話すシーンでは、ちょいちょいコミカルなアニメーションを入れていきたいと思っています。海外のビジュアルノベルだったり手書きアニメーションが好きで、少しでも雰囲気が寄せたいというのが理由です。あとほら、ずっと何かしら動かしてたら...多少絵が下手でも...言い訳できそうだし...</p>
          <p>プログラムとしては、表情が切り替わるときに、一度きりのアニメーションが流せるような実装を入れました。例えば、上の表情差分は全体が15枚の画像からなるのですが、内訳は以下のようになります。</p>
          <ol type="A">
            <li>メガネがクイってなるアニメ...9フレーム</li>
            <li>メガネをクイってしたあとの、目が開いてるアニメ...3フレーム</li>
            <li>メガネをクイってしたあとの、まばたきするアニメ...2フレーム</li>
          </ol>          
          <p>表情が切り替わると、そのキャラの立ち絵は一度だけ(A)が再生され、そのあとは(B)のループ、そして一定の間隔ごとに(C)が流れます。</p>
          <p>ゲームファイルとしては、これらは4ケタの数字がついた連番画像と、1つの<code>counts.csv</code>というCSVが入った、<code>lib/images/moko/glassflash/</code>というディレクトリで管理されています。</p>
          <figure>
            <img src="./finder.png">
          </figure>
          <p><code>counts.csv</code>はこんなことが書かれただけの簡素なファイルです。</p>
          <figure>
            <img src="./csv.png" alt="9,3,2">
          </figure>
          <p>これだけ！すると、プログラムが9フレーム、3フレーム、2フレームをそれぞれ(A)(B)(C)のフレーム数として解釈し、あとは狙い通りの立ち絵が再生されるようになります。アニメーションが長くなったら数字を変えるし、(A)がない表情であれば<code>0,3,2</code>のようにします。</p>
          <p>元々、(A)(B)(C)は別々のディレクトリで管理していました。その場合、(A)のフォルダに入ってる画像は全部(A)のやつなので、枚数を記録する必要はありません。最初はそっちのほうが便利だと思いましたが、クリスタだと大体(A)(B)(C)は1つのタイムラインでプレビューしています。そのまま連番でガーっと書き出して。あとからフレーム数を文字で書き換える、というほうが一々分けて書き出すより便利そうだったので、こんな形で実装し直しました。</p>
          <p>こんな感じで、自分の作業フローに合わせて自由に実装できるのは、Ebitengineや薄めのゲームエンジンにしかない良さかもしれません。開発日記にも書けるし。</p>
          <p>...というわけで今週は以上です。また次週の記事でお会いしましょう！</p>          
        </article>
      </div>
    </div>
    <footer>
      <div>(C) SAFE HAVN STUDIO - email:</div>
      <address class="flex-grow-1">contact@safehavn.dev</address>
      <div><a href="/" class="footer-right">TOP</a></div>
    </footer>
  </body>
</html>
